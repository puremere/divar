@model divar.ViewModel.createItemVM

@{
    ViewBag.Title = "createItem";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section scripts{

    <link href="~/Content/easy-autocomplete.min.css" rel="stylesheet" />
    <script src="~/Scripts/jquery.easy-autocomplete.min.js"></script>

    <link rel="stylesheet" href="https://cdn.map.ir/web-sdk/1.4.2/css/mapp.min.css">
    <link rel="stylesheet" href="https://cdn.map.ir/web-sdk/1.4.2/css/fa/style.css">

    <link href="~/Content/persian-datepicker.css" rel="stylesheet" />
 

    <input style="display:none" id="lat" />
    <input style="display:none" id="lon" />
    <style>
        .parent {
            display: block;
            width: 100%;
            height: 100%;
            background-color: white;
            padding: 50px 35%;
            text-align: right;
        }

        .itemRow {
            padding: 5px;
            direction: rtl;
            text-align: right;
        }
    </style>

    <script>
        var subcatstr = '@Model.locationData.data.listcompany';
        var subcats = {
            data: subcatstr.split("-"),
            list: {
                maxNumberOfElements: 10,
                match: {
                    enabled: true
                }
            }
    };
    </script>
    <div class="parent">
        @{
            int w = Request.Browser.ScreenPixelsWidth;
            int h = Request.Browser.ScreenPixelsHeight;
            if (Request.Browser.IsMobileDevice || (w < 720 && h > 720))
            {
                <style>
                    .itemRow {
                        padding: 5px;
                        direction: rtl;
                        text-align: right;
                        border: 1px solid #82DEED;
                        padding: 15px;
                        border-radius: 8px;
                        margin-top: 10px;
                    }

                        .itemRow input {
                            border: none;
                            box-shadow: none
                        }

                        .itemRow p {
                            border: none
                        }

                    .offtor {
                        border: 1px solid #eee;
                    }
                </style>
                <div class="">

                    <div id="imageHolder" style="z-index:999; position:relative;top:0; left:0;  background-color:white; display:block; text-align:center; background-color:white;  /* Negative half of width. */">


                    </div>


                </div>
                <script>
                    $.ajax({
                        url: "imageSectionApp",
                        dataType: "html",
                        success: function (data) {
                            $("#imageHolder").html(data);
                        }
                    })
                </script>
                <div class="itemRow">
                    <p>نام پروژه :</p>

                    <input placeholder="شرکت سازنده / نام پروژه" id="title" class="form-control" />
                </div>
                <div class="itemRow">
                    <p>شماره تماس آکهی دهنده :</p>


                    <input placeholder="شماره تماس" id="title" class="form-control" />
                </div>
                <div class="itemRow">
                    <p> نوع کاربری ملک شما :</p>

                    <select class="form-control">
                        <option>
                            تجاری
                        </option>
                        <option>
                            مسکونی
                        </option>
                        <option>
                            اداری
                        </option>
                    </select>
                </div>
                <div class="itemRow">
                    <p>درصد پیشرفت پروژه :</p>

                    <input id="title" class="form-control" />
                </div>
                <div class="itemRow">
                    <p>تاریخ تحویل :</p>

                    <input id="" class="form-control projectDate" />
                </div>
                <div class="itemRow">
                    <p>تاریخ شروع :</p>

                    <input placeholder="تاریخ شروع" id="" class="form-control projectDate" />
                </div>

                <div class="itemRow">
                    <p>تعداد طبقات :</p>
                    <input placeholder="تعداد طبقات" id="tabaghat" class="form-control" />
                </div>
                <div class="itemRow">
                    <p>تعداد واحد در طبقه :</p>

                    <input id="title" class="form-control" />
                </div>
                <div class="itemRow">
                    <p>استان</p>
                    <input placeholder="استان" id="" class="form-control state" />
                </div>
                <div class="itemRow">
                    <p>شهر</p>
                    <input placeholder="شهر" class="form-control city" />
                </div>
                <div class="itemRow">
                    <p>منطقه</p>
                    <input placeholder="منطقه" id="region" class="form-control" />
                </div>

                <div class="itemRow">
                    <p>نام تعاونی سازنده :</p>
                    <input placeholder="نام شرکت" id="companyList" class="form-control" />
                </div>

                <div style="display: flex;align-items: center;justify-content: center;">
                    <p style="margin:20px;"><input id="One" class="chckBoxItem" type="checkbox" checked /> پیش فروش</p>
                    <p style="margin:20px;"><input id="Two" class="chckBoxItem" type="checkbox" /> امتیاز </p>
                </div>

                <div class="itemRow Two offtor">

                    <p>جمع مبالغ پرداختی : <span id="varizHarf" style="float:left"></span></p>

                    <input id="variz" class="form-control" disabled />
                </div>
                <div class="itemRow Two offtor">

                    <p>مبلغ حق امتیاز : <span id="emtiazHarf" style="float:left"></span></p>

                    <input placeholder="مبلغ واریز" id="emtiaz" class="form-control" disabled />
                </div>



                <div class="itemRow One">

                    <p>مبلغ هر متر مربع  : <span id="metriHarf" style="float:left"></span></p>

                    <input id="metri" placeholder="مبلغ بر اساس هر متر مربع " class="form-control" />
                </div>
                <div class="itemRow">
                    <p>متراژ هر واحد :</p>
                    <input id="wholeMetr" class="form-control" placeholder="متراژ هر واحد" />
                </div>
                <div class="itemRow">

                    <p>مبلغ کل : <span id="kolHarf" style="float:left"></span></p>

                    <p id="kol" class="form-control"></p>
                </div>
                <div class="itemRow">
                    <p>آدرس :</p>


                    <input placeholder="آدرس" id="title" class="form-control" />
                </div>








                <div class="itemRow">
                    <p>توضیحات و امکانات :</p>

                    <input id="title" class="form-control" />
                </div>
                <div class="itemRow">
                    <p>موقعیت</p>
                    <div id="mapHolder" style="z-index:999; position:relative;top:0; left:0; width:100%; height:250px;  background-color:white; display:block; text-align:center; background-color:white;  /* Negative half of width. */">
                        <div id="mapshow" style="position:absolute; width:100%; height:90%; z-index:999999">
                            <p style="cursor:pointer;   z-index: 9999999; width: 100%;bottom: 0;position: absolute;"><span style=" color: white; background-color: #4f9d94; border-radius: 5px; padding: 20px 30px;">انتخاب موقعیت</span></p>
                        </div>
                        <div id="Map" style="margin-top:5%; width: 100%; margin:auto; height: 90%; background: #eee; border: 2px solid #aaa;"></div>
                        <p id="maphide" style="display:none; cursor:pointer;   z-index: 9999999; width: 100%;bottom: 15px;position: absolute;"><span style=" color: white; background-color: #4f9d94; border-radius: 5px; padding: 20px 30px;">انتخاب موقعیت</span></p>
                    </div>
                </div>
                <p style="width:100%; padding:20px; margin-top:10px; background-color:#4f9d94; text-align:center;color:white; font-size:14px; border-radius:5px">تایید </p>

            }
            else
            {
                <div class="itemRow">
                    <p style="font-weight:600; font-size:16px">ثبت رایگان آگهی</p>
                </div>


                <div class="itemRow">
                    <p>آپلود عکس :</p>
                    <div id="imageHolder" style="z-index:999; position:relative;top:0; left:0;  background-color:white; display:block; text-align:center; background-color:white;  /* Negative half of width. */">


                    </div>


                </div>
                <script>
                    $.ajax({
                        url: "imageSection",
                        dataType: "html",
                        success: function (data) {
                            $("#imageHolder").html(data);
                        }
                    })
                </script>


                <div class="itemRow">
                    <p>عنوان :</p>

                    <input id="title" class="form-control" />
                </div>
                <div class="itemRow">
                    <p>شماره تماس :</p>

                    <input id="title" class="form-control" />
                </div>
                <div class="itemRow">
                    <p>نوع کاربری :</p>

                    <input id="title" class="form-control" />
                </div>
                <div class="itemRow">
                    <p>متراژ هر واحد :</p>
                    <input id="wholeMetr" class="form-control" placeholder="متراژ هر واحد" />
                </div>
                <div class="itemRow">

                    <p>مبلغ بر اساس هر متر مربع  : <span id="metriHarf" style="float:left"></span></p>

                    <input id="metri" placeholder="مبلغ بر اساس هر متر مربع " class="form-control" />
                </div>
                <div class="itemRow">

                    <p>مجموع واریزی ها : <span id="varizHarf" style="float:left"></span></p>

                    <input placeholder="مجموع واریزی ها" id="variz" class="form-control" />
                </div>
                <div class="itemRow">

                    <p>مبلغ حق امتیاز : <span id="emtiazHarf" style="float:left"></span></p>

                    <input placeholder="مبلغ واریز" id="emtiaz" class="form-control" />
                </div>
                <div class="itemRow">

                    <p>مبلغ کل : <span id="kolHarf" style="float:left"></span></p>

                    <p id="kol" class="form-control"></p>
                </div>
                <div class="itemRow">
                    <p>نام شرکت سازنده :</p>

                    <input id="companyList" class="form-control" />
                </div>

                <div class="itemRow">
                    <p>استان</p>
                    <input id="" class="form-control state" />
                </div>
                <div class="itemRow">
                    <p>شهر</p>
                    <input id="" class="form-control city" />
                </div>
                <div class="itemRow">
                    <p>منطقه</p>
                    <input id="region" class="form-control" />
                </div>
                <div class="itemRow">
                    <p>تاریخ شروع :</p>

                    <input class="form-control projectDate" />
                </div>

                <div class="itemRow">
                    <p>درصد پیشرفت پروژه :</p>

                    <input id="title" class="form-control" />
                </div>
                <div class="itemRow">
                    <p>تاریخ تحویل :</p>

                    <input id="" class="form-control projectDate" />
                </div>
                <div class="itemRow">
                    <p>تعداد واحد :</p>

                    <input id="title" class="form-control" />
                </div>
                <div class="itemRow">
                    <p>متراژ واحد :</p>

                    <input id="title" class="form-control" />
                </div>
                <div class="itemRow">
                    <p>تعداد طبقات  :</p>

                    <input id="tabaghat" class="form-control" />
                </div>

                <div class="itemRow">
                    <p>توضیحات و امکانات :</p>

                    <input id="title" class="form-control" />
                </div>
                <div class="itemRow">
                    <p>موقعیت</p>
                    <div id="mapHolder" style="z-index:999; position:relative;top:0; left:0; width:100%; height:250px;  background-color:white; display:block; text-align:center; background-color:white;  /* Negative half of width. */">

                        <div id="map" style="margin-top:5%; width: 100%; margin:auto; height: 90%; background: #eee; border: 2px solid #aaa;"></div>

                    </div>
                </div>


                <div class="itemRow">
                    <p class="btn btn-success">تایید :</p>


                </div>
            }



        }



    </div>

    <script>


    var list =  @Html.Raw(Json.Encode(@Model.locationData.data.liststate));
    var products = {
        data: list,
        getValue: "title",
        list: {
            match: {
                enabled: true
            },
            onClickEvent: function () {
                $.each(list, function (index, item) {
                    // access the properties of each user
                    var ID = item.ID;
                    var title = item.title;
                    if (title == $(".state").val()) {
                        $.ajax({
                            url: '/Home/getLocation',
                            dataType: 'html',
                            data: {
                                city_id: ID,
                            },
                            success: function (data) {
                                var lst = JSON.parse(data);

                                var cities = {
                                    data: lst.data.listcity,
                                    getValue: "title",
                                    list: {
                                        match: {
                                            enabled: true
                                        }
                                    }


                                }
                                $(".city").easyAutocomplete(cities);



                            }
                        });

                    }


                });
            }

        },
        //template: {
        //    type: "custom",
        //    method: function (value, item) {
        //        return item.title
        //    }
        //},


    };
    $(".state").easyAutocomplete(products);
    </script>


    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin="">

    </script>
    <script type="text/javascript">
        var myMap;
        getLocation();
        function showLocation(position) {
            var lat = position.coords.latitude;
            var lon = position.coords.longitude;



            var myMap = L.map('Map', { attributionControl: false }).setView([51.505, -0.09], 13);
            L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                maxZoom: 18,
                id: 'mapbox/streets-v11',
                tileSize: 512,
                zoomOffset: -1,
                accessToken: 'pk.eyJ1IjoibWVyaW9saSIsImEiOiJja2p6dXhmdngwYmVvMnZwY2lyc2htNGxhIn0.Y9t__Bll6Fw9b9amb_rcHg',

            }).addTo(myMap);
            myMap.panTo(new L.LatLng(lat, lon));

            var greenIcon = new L.Icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            });






            var theMarker = {};
            myMap.on('click', function (e) {

                lat = e.latlng.lat;
                lon = e.latlng.lng;

                console.log("You clicked the map at LAT: " + lat + " and LONG: " + lon);
                //Clear existing marker,

                if (theMarker != undefined) {
                    myMap.removeLayer(theMarker);
                };

                //Add a marker to show where you clicked.
                theMarker = L.marker([lat, lon], { icon: greenIcon }).addTo(myMap);
                $("#lat").val(lat);
                $("#lon").val(lon);
            });
            theMarker = L.marker([lat, lon], { icon: greenIcon }).addTo(myMap);
            $("#lat").val(lat);
            $("#lon").val(lon);






        }
        function errorHandler(err) {
            if (err.code == 1) {
                //alert("Error: Access is denied!");
            } else if (err.code == 2) {
                //alert("Error: Position is unavailable!");
            }


            myMap = L.map('Map', { attributionControl: false }).setView([51.505, -0.09], 13);
            L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                maxZoom: 18,
                id: 'mapbox/streets-v11',
                tileSize: 512,
                zoomOffset: -1,
                accessToken: 'pk.eyJ1IjoibWVyaW9saSIsImEiOiJja2p6dXhmdngwYmVvMnZwY2lyc2htNGxhIn0.Y9t__Bll6Fw9b9amb_rcHg',

            }).addTo(myMap);
            myMap.panTo(new L.LatLng(35.73598454240641, 51.48437862217327));


            var greenIcon = new L.Icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            });




            var theMarker = {};
            myMap.on('click', function (e) {

                lat = e.latlng.lat;
                lon = e.latlng.lng;

                console.log("You clicked the map at LAT: " + lat + " and LONG: " + lon);
                //Clear existing marker,

                if (theMarker != undefined) {
                    myMap.removeLayer(theMarker);
                };

                //Add a marker to show where you clicked.
                theMarker = L.marker([lat, lon], { icon: greenIcon }).addTo(myMap);

                $("#lat").val(lat);
                $("#lon").val(lon);
            });


        }
        function getLocation() {
            if (navigator.geolocation) {
                // timeout at 60000 milliseconds (60 seconds)
                var options = { timeout: 60000 };
                navigator.geolocation.getCurrentPosition
                    (showLocation, errorHandler, options);
            } else {
                alert("Sorry, browser does not support geolocation!");
            }
        }







    </script>
    <script>
        $(document).ready(function () {
            $(".fa-file").addClass("act")
        })
    </script>
    <script>
        $("#mapshow p").click(function () {
            $("#mapshow").hide();
            $("#mapHolder").css("position", "fixed");
            $("#mapHolder").css("width", "100%");
            $("#mapHolder").css("height", "100%");
            $("#maphide").css("display", "block")

        })
        $("#maphide span").click(function () {
            $("#mapHolder").css("position", "relative");
            $("#mapHolder").css("width", "100%");
            $("#mapHolder").css("height", "250px");
            $("#mapshow").css("display", "block");
            $("#mapshow").show();
            var lat = $("#lat").val();
            var lon = $("#lon").val();
            myMap.panTo(new L.LatLng(lat, lon));
            $("#maphide").hide();
        })
        $("#wholeMetr").on('input', function () {

            if (this.value.length > 0) {
                var metri = $("#metri").val();
                if (metri.length > 0) {
                    let kol = parseInt(this.value) * parseInt(metri);
                    $.ajax({
                        url: '/Home/returnHarf',
                        dataType: 'html',
                        data: {
                            number: kol,
                        },
                        success: function (data) {

                            $('#kolHarf').text(data + " تومان");
                            $('#kol').text(kol);
                            // alert(addCommas($(this).val()))
                            // $(this).digits();
                        }


                    })
                }
            }

        })
        $("#metri").on("input", function () {
            if (/\D/g.test(this.value)) this.value = this.value.replace(/\D/g, '');
            if (this.value.length > 0) {
                $.ajax({
                    url: '/Home/returnHarf',
                    dataType: 'html',
                    data: {
                        number: this.value,
                    },
                    success: function (data) {

                        $('#metriHarf').text(data + " تومان");
                        $("#variz").prop("disabled", true);
                        $("#emtiaz").prop("disabled", true);

                        // alert(addCommas($(this).val()))
                        // $(this).digits();
                    }



                })
                var whole = $("#wholeMetr").val();

                if (whole.length > 0) {

                    let kol = parseInt(whole) * parseInt(this.value);
                    $('#kol').text(kol);
                    $.ajax({
                        url: '/Home/returnHarf',
                        dataType: 'html',
                        data: {
                            number: kol,
                        },
                        success: function (data) {

                            $('#kolHarf').text(data + " تومان");
                            $('#kol').text(kol);
                            // alert(addCommas($(this).val()))
                            // $(this).digits();
                        }


                    })
                }
            }
            else {
                $("#variz").prop("disabled", false);
                $("#emtiaz").prop("disabled", false);

                $('#metriHarf').text('');
                $('#kolHarf').text("");
                $('#kol').text("");
            }

        })
        $("#variz").on("input", function () {
            if (/\D/g.test(this.value)) this.value = this.value.replace(/\D/g, '');
            if (this.value.length > 0) {
                $.ajax({
                    url: '/Home/returnHarf',
                    dataType: 'html',
                    data: {
                        number: this.value,
                    },
                    success: function (data) {

                        $('#varizHarf').text(data + " تومان");
                        // alert(addCommas($(this).val()))
                        // $(this).digits();
                    }


                })
            }
            else {
                $('#varizHarf').text('');
            }

        })
        $("#emtiaz").on("input", function () {
            if (/\D/g.test(this.value)) this.value = this.value.replace(/\D/g, '');
            if (this.value.length > 0) {
                $.ajax({
                    url: '/Home/returnHarf',
                    dataType: 'html',
                    data: {
                        number: this.value,
                    },
                    success: function (data) {

                        $('#emtiazHarf').text(data + " تومان");
                        // alert(addCommas($(this).val()))
                        // $(this).digits();
                    }
                })
                if ($("#variz").val().length > 0) {
                    let kol = parseInt($("#variz").val()) + parseInt(this.value);
                    $('#kol').text(kol);
                    $.ajax({
                        url: '/Home/returnHarf',
                        dataType: 'html',
                        data: {
                            number: kol,
                        },
                        success: function (data) {

                            $('#kolHarf').text(data + " تومان");
                            // alert(addCommas($(this).val()))
                            // $(this).digits();
                        }


                    })
                }

            }
            else {
                $('#emtiazHarf').text("");
                $('#kolHarf').text("");
                $('#kol').text("");
            }

        })

        $(".chckBoxItem").click(function () {

            var id = $(this).attr('id');
            if (id == "One") {

                $("#Two").prop("checked", false);
                $(".Two").addClass("offtor");
                $(".Two input").prop("disabled", true);
                $(".One").removeClass("offtor");
                $(".One input").prop("disabled", false);
            }
            else {

                $("#One").prop("checked", false);
                $(".One").addClass("offtor");
                $(".One input").prop("disabled", true);
                $(".Two").removeClass("offtor");
                $(".Two input").prop("disabled", false);
            }


        })

    </script>
    <script>
        var conpamies = {
            data: @Html.Raw(Json.Encode(Model.locationData.data.listcompany)),
            getValue: "ID",
            template: {
                type: "custom",
                method: function (value, item) {
                    return item.title
                }
            }

        };

        $("#companyList").easyAutocomplete(conpamies);
    </script>
    <script src="~/Scripts/persian-date.js"></script>
    <script src="~/Scripts/persian-datepicker.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $(".projectDate").pDatepicker();
        });
    </script>