@model divar.ViewModel.createItemVM

@{
    ViewBag.Title = "createItem";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section scripts{

    <link href="~/Content/easy-autocomplete.min.css" rel="stylesheet" />
    <script src="~/Scripts/jquery.easy-autocomplete.min.js"></script>

    <link rel="stylesheet" href="https://cdn.map.ir/web-sdk/1.4.2/css/mapp.min.css">
    <link rel="stylesheet" href="https://cdn.map.ir/web-sdk/1.4.2/css/fa/style.css">

    <link href="~/Content/persian-datepicker.css" rel="stylesheet" />


}

<input style="display:none" id="lat" />
<input style="display:none" id="lon" />
<style>
    .parent {
        display: block;
        width: 100%;
        height: 100%;
        background-color: white;
        padding: 50px 35%;
        text-align: right;
    }

    .itemRow {
        padding: 5px;
        direction: rtl;
        text-align: right;
    }
</style>

<script>
        var subcatstr = '@Model.locationData.data.listcompany';
        var subcats = {
            data: subcatstr.split("-"),
            list: {
                maxNumberOfElements: 10,
                match: {
                    enabled: true
                }
            }
    };
</script>
<div class="parent">
    @{
        int w = Request.Browser.ScreenPixelsWidth;
        int h = Request.Browser.ScreenPixelsHeight;
        if (Request.Browser.IsMobileDevice || (w < 720 && h > 720))
        {
            <style>
                .itemRow {
                    padding: 5px;
                    direction: rtl;
                    text-align: right;
                    border: 1px solid #82DEED;
                    padding: 15px;
                    border-radius: 8px;
                    margin-top: 10px;
                }

                    .itemRow input {
                        border: none;
                        box-shadow: none
                    }

                    .itemRow p {
                        border: none
                    }
            </style>
            <div class="">

                <div id="imageHolder" style="z-index:999; position:relative;top:0; left:0;  background-color:white; display:block; text-align:center; background-color:white;  /* Negative half of width. */">


                </div>


            </div>
            <script>
                $.ajax({
                    url: "imageSectionApp",
                    dataType: "html",
                    success: function (data) {
                        $("#imageHolder").html(data);
                    }
                })
            </script>
            <div class="itemRow">
                <p>عنوان :</p>

                <input placeholder="شرکت سازنده / نام پروژه" id="title" class="form-control" />
            </div>
            <div class="itemRow">
                <p>شماره تماس :</p>


                <input placeholder="شماره تماس" id="title" class="form-control" />
            </div>
            <div class="itemRow">
                <p>نوع کاربری :</p>

                <select class="form-control">
                    <option>
                        تجاری
                    </option>
                    <option>
                        مسکونی
                    </option>
                    <option>
                        اداری
                    </option>
                </select>
            </div>
            <div class="itemRow">
                <p>متراژ هر واحد :</p>
                <input id="wholeMetr" class="form-control" placeholder="متراژ هر واحد" />
            </div>
            <div class="itemRow">

                <p>مبلغ بر اساس هر متر مربع  : <span id="metriHarf" style="float:left"></span></p>

                <input id="metri" placeholder="مبلغ بر اساس هر متر مربع " class="form-control" />
            </div>
            <div class="itemRow">

                <p>مجموع واریزی ها : <span id="varizHarf" style="float:left"></span></p>

                <input placeholder="مجموع واریزی ها" id="variz" class="form-control" />
            </div>
            <div class="itemRow">

                <p>مبلغ حق امتیاز : <span id="emtiazHarf" style="float:left"></span></p>

                <input placeholder="مبلغ واریز" id="emtiaz" class="form-control" />
            </div>
            <div class="itemRow">

                <p>مبلغ کل : <span id="kolHarf" style="float:left"></span></p>

                <p id="kol" class="form-control"></p>
            </div>

            <div class="itemRow">
                <p>تعداد طبقات :</p>
                <input placeholder="تعداد طبقات" id="tabaghat" class="form-control" />
            </div>
            <div class="itemRow">
                <p>نام شرکت سازنده :</p>


                <input placeholder="نام شرکت" id="companyList" class="form-control" />
            </div>
            <div class="itemRow">
                <p>نام شرکت سازنده :</p>


                <input placeholder="نام شرکت" id="title" class="form-control" />
            </div>
            <div class="itemRow">
                <p>آدرس :</p>


                <input placeholder="آدرس" id="title" class="form-control" />
            </div>
            <div class="itemRow">
                <p>استان</p>
                <input placeholder="استان" id="" class="form-control state" />
            </div>
            <div class="itemRow">
                <p>شهر</p>
                <input placeholder="شهر" class="form-control city" />
            </div>
            <div class="itemRow">
                <p>منطقه</p>
                <input placeholder="منطقه" id="region" class="form-control" />
            </div>
            <div class="itemRow">
                <p>تاریخ شروع :</p>

                <input placeholder="تاریخ شروع" id="" class="form-control projectDate" />
            </div>
            <div class="itemRow">
                <p>درصد پیشرفت پروژه :</p>

                <input id="title" class="form-control" />
            </div>
            <div class="itemRow">
                <p>تاریخ تحویل :</p>

                <input id="" class="form-control projectDate" />
            </div>
            <div class="itemRow">
                <p>تعداد واحد :</p>

                <input id="title" class="form-control" />
            </div>


            <div class="itemRow">
                <p>توضیحات و امکانات :</p>

                <input id="title" class="form-control" />
            </div>
            <div class="itemRow">
                <p>موقعیت</p>
                <div id="mapHolder" style="z-index:999; position:relative;top:0; left:0; width:100%; height:250px;  background-color:white; display:block; text-align:center; background-color:white;  /* Negative half of width. */">

                    <div id="map" style="margin-top:5%; width: 100%; margin:auto; height: 90%; background: #eee; border: 2px solid #aaa;"></div>

                </div>
            </div>
            <p class="btn btn-success" style="width:100%; padding:10px; margin-top:10px">تایید </p>

        }
        else
        {
            <div class="itemRow">
                <p style="font-weight:600; font-size:16px">ثبت رایگان آگهی</p>
            </div>


            <div class="itemRow">
                <p>آپلود عکس :</p>
                <div id="imageHolder" style="z-index:999; position:relative;top:0; left:0;  background-color:white; display:block; text-align:center; background-color:white;  /* Negative half of width. */">


                </div>


            </div>
            <script>
                $.ajax({
                    url: "imageSection",
                    dataType: "html",
                    success: function (data) {
                        $("#imageHolder").html(data);
                    }
                })
            </script>


            <div class="itemRow">
                <p>عنوان :</p>

                <input id="title" class="form-control" />
            </div>
            <div class="itemRow">
                <p>شماره تماس :</p>

                <input id="title" class="form-control" />
            </div>
            <div class="itemRow">
                <p>نوع کاربری :</p>

                <input id="title" class="form-control" />
            </div>
            <div class="itemRow">
                <p>متراژ هر واحد :</p>
                <input id="wholeMetr" class="form-control" placeholder="متراژ هر واحد" />
            </div>
            <div class="itemRow">

                <p>مبلغ بر اساس هر متر مربع  : <span id="metriHarf" style="float:left"></span></p>

                <input id="metri" placeholder="مبلغ بر اساس هر متر مربع " class="form-control" />
            </div>
            <div class="itemRow">

                <p>مجموع واریزی ها : <span id="varizHarf" style="float:left"></span></p>

                <input placeholder="مجموع واریزی ها" id="variz" class="form-control" />
            </div>
            <div class="itemRow">

                <p>مبلغ حق امتیاز : <span id="emtiazHarf" style="float:left"></span></p>

                <input placeholder="مبلغ واریز" id="emtiaz" class="form-control" />
            </div>
            <div class="itemRow">

                <p>مبلغ کل : <span id="kolHarf" style="float:left"></span></p>

                <p id="kol" class="form-control"></p>
            </div>
            <div class="itemRow">
                <p>نام شرکت سازنده :</p>

                <input id="companyList" class="form-control" />
            </div>

            <div class="itemRow">
                <p>استان</p>
                <input id="" class="form-control state" />
            </div>
            <div class="itemRow">
                <p>شهر</p>
                <input id="" class="form-control city" />
            </div>
            <div class="itemRow">
                <p>منطقه</p>
                <input id="region" class="form-control" />
            </div>
            <div class="itemRow">
                <p>تاریخ شروع :</p>

                <input class="form-control projectDate" />
            </div>

            <div class="itemRow">
                <p>درصد پیشرفت پروژه :</p>

                <input id="title" class="form-control" />
            </div>
            <div class="itemRow">
                <p>تاریخ تحویل :</p>

                <input id="" class="form-control projectDate" />
            </div>
            <div class="itemRow">
                <p>تعداد واحد :</p>

                <input id="title" class="form-control" />
            </div>
            <div class="itemRow">
                <p>متراژ واحد :</p>

                <input id="title" class="form-control" />
            </div>
            <div class="itemRow">
                <p>تعداد طبقات  :</p>

                <input id="tabaghat" class="form-control" />
            </div>

            <div class="itemRow">
                <p>توضیحات و امکانات :</p>

                <input id="title" class="form-control" />
            </div>
            <div class="itemRow">
                <p>موقعیت</p>
                <div id="mapHolder" style="z-index:999; position:relative;top:0; left:0; width:100%; height:250px;  background-color:white; display:block; text-align:center; background-color:white;  /* Negative half of width. */">

                    <div id="map" style="margin-top:5%; width: 100%; margin:auto; height: 90%; background: #eee; border: 2px solid #aaa;"></div>

                </div>
            </div>


            <div class="itemRow">
                <p class="btn btn-success">تایید :</p>


            </div>
        }



    }



</div>

<script>


    var list =  @Html.Raw(Json.Encode(@Model.locationData.data.liststate));
    var products = {
        data: list,
        getValue: "title",
        list: {
            match: {
                enabled: true
            },
            onClickEvent: function () {
                $.each(list, function (index, item) {
                    // access the properties of each user
                    var ID = item.ID;
                    var title = item.title;
                    if (title == $(".state").val()) {
                        $.ajax({
                            url: '/Home/getLocation',
                            dataType: 'html',
                            data: {
                                city_id: ID,
                            },
                            success: function (data) {
                                var lst = JSON.parse(data);

                                var cities = {
                                    data: lst.data.listcity,
                                    getValue: "title",
                                    list: {
                                        match: {
                                            enabled: true
                                        }
                                    }


                                }
                                $(".city").easyAutocomplete(cities);



                            }
                        });

                    }


                });
            }

        },
        //template: {
        //    type: "custom",
        //    method: function (value, item) {
        //        return item.title
        //    }
        //},


    };
    $(".state").easyAutocomplete(products);
</script>


<script type="text/javascript" src="https://cdn.map.ir/web-sdk/1.4.2/js/mapp.env.js"></script>
<script type="text/javascript" src="https://cdn.map.ir/web-sdk/1.4.2/js/mapp.min.js"></script>
<script type="text/javascript">
    getLocation();
    function showLocation(position) {
        var lat = position.coords.latitude;
        var lon = position.coords.longitude;


        var myMap = new L.Map('map', {
            minZoom: 1,
            maxZoom: 20,
            center: [lat, lon],
            zoom: 18,
            attributionControl: true
        });
        var greenIcon = new L.Icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        L.TileLayer.wmsHeader(
            "https://map.ir/shiveh",
            {
                layers: "Shiveh:Shiveh",
                format: "image/png",
                minZoom: 1,
                maxZoom: 20
            },
            [
                {
                    header: "x-api-key",
                    value: "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjdjZTBhMDNiYmZiOWI3MWYxZTYwYzFiNjg2MTdkMTljZTA2Y2U4MjEzMzRlNjRkZjllNDZiYTUwMmE5NmI2YjgxMDFmYmE1Zjk1MTNjOGUzIn0.eyJhdWQiOiI4NjY0IiwianRpIjoiN2NlMGEwM2JiZmI5YjcxZjFlNjBjMWI2ODYxN2QxOWNlMDZjZTgyMTMzNGU2NGRmOWU0NmJhNTAyYTk2YjZiODEwMWZiYTVmOTUxM2M4ZTMiLCJpYXQiOjE1ODY1OTQ4MDEsIm5iZiI6MTU4NjU5NDgwMSwiZXhwIjoxNTg5MTg2ODAxLCJzdWIiOiIiLCJzY29wZXMiOlsiYmFzaWMiXX0.dCY2mtjog8J2xVXPS2FhqnGgoqrYq5mYAjqK3XxWrDDIQsv8p9lbF9ZHlSidZi3DN7EkhY6Py3E7yBJiZ_iBWhAyrJ6qpjgjEm8Eu-I0m2h1UVkrJqObtWzkaBRyl_WRxWP7hAcbSve-g5OIrWoCSkyeW_R8NqyfPD-4xMrBl3g78klaQlZbxU19rNU2OcFj8IRCMeepwiQNgKEViOuStQOqnJqBc7ofzPzr8okUBX_alwDFVx4IFXuLUAPksxqCzdwiPyfS0F1FsdoW_2T_oYIBjvzbKdcLYEAygwFZpniUIE5f3eo_pxMtWdpa40NolTx9qlBtm3FDIdDoDvIgTw"
                }
            ]
        ).addTo(myMap);




        var theMarker = {};
        myMap.on('click', function (e) {

            lat = e.latlng.lat;
            lon = e.latlng.lng;

            console.log("You clicked the map at LAT: " + lat + " and LONG: " + lon);
            //Clear existing marker,

            if (theMarker != undefined) {
                myMap.removeLayer(theMarker);
            };

            //Add a marker to show where you clicked.
            theMarker = L.marker([lat, lon], { icon: greenIcon }).addTo(myMap);
            $("#lat").val(lat);
            $("#lon").val(lon);
        });
        theMarker = L.marker([lat, lon], { icon: greenIcon }).addTo(myMap);
        $("#lat").val(lat);
        $("#lon").val(lon);






    }
    function errorHandler(err) {
        if (err.code == 1) {
            //alert("Error: Access is denied!");
        } else if (err.code == 2) {
            //alert("Error: Position is unavailable!");
        }


        //console.log("sssssss");
        var myMap = new L.Map('map', {
            minZoom: 1,
            maxZoom: 20,
            center: [35.744200574958086, 51.473131743990066],
            zoom: 15,

        });
        var greenIcon = new L.Icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        L.TileLayer.wmsHeader(
            "https://map.ir/shiveh",
            {
                layers: "Shiveh:Shiveh",
                format: "image/png",
                minZoom: 1,
                maxZoom: 20
            },
            [
                {
                    header: "x-api-key",
                    value: "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjdjZTBhMDNiYmZiOWI3MWYxZTYwYzFiNjg2MTdkMTljZTA2Y2U4MjEzMzRlNjRkZjllNDZiYTUwMmE5NmI2YjgxMDFmYmE1Zjk1MTNjOGUzIn0.eyJhdWQiOiI4NjY0IiwianRpIjoiN2NlMGEwM2JiZmI5YjcxZjFlNjBjMWI2ODYxN2QxOWNlMDZjZTgyMTMzNGU2NGRmOWU0NmJhNTAyYTk2YjZiODEwMWZiYTVmOTUxM2M4ZTMiLCJpYXQiOjE1ODY1OTQ4MDEsIm5iZiI6MTU4NjU5NDgwMSwiZXhwIjoxNTg5MTg2ODAxLCJzdWIiOiIiLCJzY29wZXMiOlsiYmFzaWMiXX0.dCY2mtjog8J2xVXPS2FhqnGgoqrYq5mYAjqK3XxWrDDIQsv8p9lbF9ZHlSidZi3DN7EkhY6Py3E7yBJiZ_iBWhAyrJ6qpjgjEm8Eu-I0m2h1UVkrJqObtWzkaBRyl_WRxWP7hAcbSve-g5OIrWoCSkyeW_R8NqyfPD-4xMrBl3g78klaQlZbxU19rNU2OcFj8IRCMeepwiQNgKEViOuStQOqnJqBc7ofzPzr8okUBX_alwDFVx4IFXuLUAPksxqCzdwiPyfS0F1FsdoW_2T_oYIBjvzbKdcLYEAygwFZpniUIE5f3eo_pxMtWdpa40NolTx9qlBtm3FDIdDoDvIgTw"
                }
            ]
        ).addTo(myMap);




        var theMarker = {};
        myMap.on('click', function (e) {

            lat = e.latlng.lat;
            lon = e.latlng.lng;

            console.log("You clicked the map at LAT: " + lat + " and LONG: " + lon);
            //Clear existing marker,

            if (theMarker != undefined) {
                myMap.removeLayer(theMarker);
            };

            //Add a marker to show where you clicked.
            theMarker = L.marker([lat, lon], { icon: greenIcon }).addTo(myMap);

            $("#lat").val(lat);
            $("#lon").val(lon);
        });


    }
    function getLocation() {
        if (navigator.geolocation) {
            // timeout at 60000 milliseconds (60 seconds)
            var options = { timeout: 60000 };
            navigator.geolocation.getCurrentPosition
                (showLocation, errorHandler, options);


        } else {
            alert("Sorry, browser does not support geolocation!");
        }
    }







</script>
<script>
    $(document).ready(function () {
        $(".fa-file").addClass("act")
    })
</script>
<script>

    $("#metri").on("input", function () {
        if (/\D/g.test(this.value)) this.value = this.value.replace(/\D/g, '');
        if (this.value.length > 0) {
            $.ajax({
                url: '/Home/returnHarf',
                dataType: 'html',
                data: {
                    number: this.value,
                },
                success: function (data) {

                    $('#metriHarf').text(data + " تومان");
                    $("#variz").prop("disabled", true);
                    $("#emtiaz").prop("disabled", true);

                    // alert(addCommas($(this).val()))
                    // $(this).digits();
                }



            })
            var whole = $("#wholeMetr").val();

            if (whole.length > 0) {

                let kol = parseInt(whole) * parseInt(this.value);
                $('#kol').text(kol);
                $.ajax({
                    url: '/Home/returnHarf',
                    dataType: 'html',
                    data: {
                        number: kol,
                    },
                    success: function (data) {

                        $('#kolHarf').text(data + " تومان");
                        // alert(addCommas($(this).val()))
                        // $(this).digits();
                    }


                })
            }
        }
        else {
            $("#variz").prop("disabled", false);
            $("#emtiaz").prop("disabled", false);

            $('#metriHarf').text('');
            $('#kolHarf').text("");
            $('#kol').text("");
        }

    })
    $("#variz").on("input", function () {
        if (/\D/g.test(this.value)) this.value = this.value.replace(/\D/g, '');
        if (this.value.length > 0) {
            $.ajax({
                url: '/Home/returnHarf',
                dataType: 'html',
                data: {
                    number: this.value,
                },
                success: function (data) {

                    $('#varizHarf').text(data + " تومان");
                    // alert(addCommas($(this).val()))
                    // $(this).digits();
                }


            })
        }
        else {
            $('#varizHarf').text('');
        }

    })
    $("#emtiaz").on("input", function () {
        if (/\D/g.test(this.value)) this.value = this.value.replace(/\D/g, '');
        if (this.value.length > 0) {
            $.ajax({
                url: '/Home/returnHarf',
                dataType: 'html',
                data: {
                    number: this.value,
                },
                success: function (data) {

                    $('#emtiazHarf').text(data + " تومان");
                    // alert(addCommas($(this).val()))
                    // $(this).digits();
                }
            })
            if ($("#variz").val().length > 0) {
                let kol = parseInt($("#variz").val()) + parseInt(this.value);
                $('#kol').text(kol);
                $.ajax({
                    url: '/Home/returnHarf',
                    dataType: 'html',
                    data: {
                        number: kol,
                    },
                    success: function (data) {

                        $('#kolHarf').text(data + " تومان");
                        // alert(addCommas($(this).val()))
                        // $(this).digits();
                    }


                })
            }

        }
        else {
            $('#emtiazHarf').text("");
            $('#kolHarf').text("");
            $('#kol').text("");
        }

    })



</script>
<script>
        var conpamies = {
            data: @Html.Raw(Json.Encode(Model.locationData.data.listcompany)),
            getValue: "ID",
            template: {
                type: "custom",
                method: function (value, item) {
                    return item.title
                }
            }

        };

        $("#companyList").easyAutocomplete(conpamies);
</script>
<script src="~/Scripts/persian-date.js"></script>
<script src="~/Scripts/persian-datepicker.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $(".projectDate").pDatepicker();
    });
</script>